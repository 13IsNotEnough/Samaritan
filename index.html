<!DOCTYPE html>
<html>
    <head>
        <title>Samaritan</title>
        <meta charset="UTF-8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
        <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script type="text/javascript">
            $State = {
                isText: false,
                wordTime: 750,
                wordAnim: 150
            };

            $.fn.textWidth = function(){
              var html_org = $(this).html();
              var html_calc = '<span>' + html_org + '</span>';
              $(this).html(html_calc);
              var width = $(this).find('span:first').width();
              $(this).html(html_org);
              return width;
            };

            $(document).ready(function(){
                $State.triangle = $('#triangle');
                $State.text  = $('#main p');
                $State.line = $('#main hr');
                
                blinkTriangle();

                $.ajax({
                  dataType: "json",
                  url: "phraselist.json"
                }).done(function(phraselist){
                    $State.phraselist = phraselist;
                    $(document).bind('click', function(){
                        var randomIndex = Math.floor(Math.random() * ($State.phraselist.length - 0));
                        executeSamaritan($State.phraselist[randomIndex]);
                    });
                });
            })
            
            var blinkTriangle = function()
            {
                if ($State.isText)
                    return;
                $State.triangle.fadeTo(500, 0).fadeTo(500, 1, blinkTriangle);
            }

            var executeSamaritan = function(phrase)
            {
                if ($State.isText)
                    return;

                $State.isText = true
                var phraseArray = phrase.split(" ");
                $State.triangle.finish().animate({
                    'font-size': '0em',
                    'opacity': '1'
                }, {
                    'duration': $State.wordAnim,
                    'done': function() {
                        // Create timers for each word
                        phraseArray.forEach(function (word, i) {
                            setTimeout(function(){
                                $State.text.css('color', '#000').html(word);
                                $State.line.animate({
                                    'width' : ($State.text.textWidth() + 18) + "px"
                                }, {
                                    'duration': $State.wordAnim,
                                    'start': $State.text.css('color','#FFF')
                                })
                            }, (i * $State.wordTime) - $State.wordAnim)
                        });

                        // Set a final timer to hide text and show triangle
                        setTimeout(function(){
                            $State.text.html("");
                            $State.triangle.finish().animate({
                                'font-size': '2em',
                                'opacity': '1'
                            }, {
                                'duration': $State.wordAnim,
                                'done': function(){
                                    $State.isText = false;
                                    blinkTriangle();
                                    $State.line.animate({
                                        'width' : "30px"
                                    }, {
                                        'duration': $State.wordAnim,
                                        'start': $State.text.css('color','#FFF')
                                    })
                                }
                            });
                        },
                        phraseArray.length * $State.wordTime);
                    }
                });

                $
            }
        </script>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div id="main">
            <p>&nbsp;</p>
            <hr />
        </div>
        <div id="marker">
            <span id="triangle">&#9650</span>
        </div>
    </body>
</html>
